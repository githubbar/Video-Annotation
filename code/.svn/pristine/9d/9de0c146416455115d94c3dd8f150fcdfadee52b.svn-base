""" 
Build script for cxFreeze library

add ""from PyQt4 import QtNetwork"" to Ui_window.py

Run this file with "build" command line argument to build an exe. Run as administrator to access dll's in system dir.
egg includes (e.g. elixir library) must by unzipped for cx_freeze to find them
"""

from cx_Freeze import setup, Executable
import sys
import os
import glob
import PyQt4.Qt as qt
import subprocess

Target_1 = Executable(
    # what to build
    script = "main.py",
    initScript = None,
    base = 'Win32GUI',
    targetName = "VideoAnnotationTool.exe",
    compress = True,
    copyDependentFiles = True,
    appendScriptToExe = False,
    appendScriptToLibrary = False, 
    icon = "icons\icon.ico"
    )
    
    
include_files = ["icons", "palettes"]

app = qt.QApplication([])

# Generate help and add help files and sqlite dll
subprocess.call(['qcollectiongenerator', 'help/help.qhcp', '-o', 'help/help.qhc'], shell=True)
include_files.append(('help', 'help'))
include_files.append((os.path.join(str(qt.QLibraryInfo.location(qt.QLibraryInfo.PluginsPath)), 'sqldrivers', 'qsqlite4.dll'), 'plugins/sqldrivers/qsqlite4.dll'))  # help stores in sql lite format

# Coppy necessary dll's from the PyQt plugins directory
include_files.append((os.path.join(str(qt.QLibraryInfo.location(qt.QLibraryInfo.PluginsPath)), 'imageformats'), 'plugins/imageformats'))

# Coppy VLC dll's 
vlcDir = str("c:/Program Files (x86)/VideoLAN/VLC")
for f in glob.glob(os.path.join(vlcDir,'*.dll')):
    include_files.append((f, os.path.basename(f)))
include_files.append((os.path.join(vlcDir, 'plugins'), 'plugins'))

# Copy qt.conf from (without it the icons don't show)
include_files.append('qt.conf')

# Copy FFMPEG dll's
ffmpegDir = str("c:/Program Files (x86)/ffmpeg")
include_files.append((os.path.join(ffmpegDir, 'bin'), '.'))
include_files.append("categories.txt")

setup(
        name = "VideoAnnotationTool",
        version = "0.1",
        description = "Video Annotation Tool",
        author = "author",
        options = {"build_exe": {
            "compressed": "True",
            "excludes":  ["tcl","tk","Tkinter"],                                      
            "include_files": include_files,
            "packages": []
            } 
       },
        executables = [Target_1]
    )

